<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenFrame &bull; Sign In</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Azeret+Mono:wght@500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #161616;
            --color-bg-card: #212121;
            --color-bg-hover: #2b2b2b;
            --color-bg-active: #353535;
            --color-text-primary: #fafafa;
            --color-text-secondary: #888888;
            --color-text-muted: #747474;
            --color-text-on-accent: #212121;
            --color-text-placeholder: rgba(136, 136, 136, 0.6);
            --color-border-default: #3a3a3a;
            --color-border-hover: #444444;
            --color-border-focus: #ffc008;
            --color-accent-primary: #ffc008;
            --color-accent-hover: #f5b600;
            --color-accent-active: #ebac00;
            --color-error: #f36666;
            --color-error-bg: rgba(243, 102, 102, 0.1);
            --color-error-border: rgba(243, 102, 102, 0.3);
            --color-success: #5ea62e;
            --color-success-bg: rgba(94, 166, 46, 0.1);
            --color-success-border: rgba(94, 166, 46, 0.3);
            --radius-input: 6px;
            --radius-card: 6px;
            --radius-button: 6px;
            --shadow-card: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-focus: 0 0 0 3px rgba(255, 192, 8, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: "DM Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--color-bg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            color: var(--color-text-primary);
        }

        .logo {
            position: fixed;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo h1 {
            font-family: "Azeret Mono", "SF Mono", Monaco, monospace;
            color: var(--color-text-primary);
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .login-container {
            background: var(--color-bg-card);
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-card);
            padding: 40px;
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .login-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .login-header h2 {
            font-family: "Azeret Mono", "SF Mono", Monaco, monospace;
            font-size: 32px;
            font-weight: 600;
            color: var(--color-text-primary);
            letter-spacing: -0.02em;
            line-height: 40px;
        }

        .login-header p {
            font-size: 18px;
            font-weight: 500;
            color: var(--color-text-secondary);
            line-height: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            color: var(--color-text-primary);
            font-size: 18px;
            line-height: 24px;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border-default);
            border-radius: var(--radius-input);
            font-size: 18px;
            font-family: inherit;
            font-weight: 500;
            line-height: 24px;
            transition: border-color 200ms ease-out, box-shadow 200ms ease-out;
            background: var(--color-bg-card);
            color: var(--color-text-primary);
        }

        .form-input::placeholder {
            color: var(--color-text-placeholder);
        }

        .form-input:hover {
            border-color: rgba(255, 192, 8, 0.3);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-border-focus);
            box-shadow: var(--shadow-focus);
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-secondary);
            transition: color 200ms ease-out;
        }

        .password-toggle:hover {
            color: var(--color-text-primary);
        }

        .form-input[type="password"] {
            padding-right: 44px;
        }

        .form-input.has-toggle {
            padding-right: 44px;
        }

        .btn {
            padding: 12px 16px;
            border: 1px solid transparent;
            border-radius: var(--radius-button);
            font-size: 18px;
            font-family: inherit;
            font-weight: 700;
            cursor: pointer;
            transition: all 200ms ease-out;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            line-height: 24px;
            letter-spacing: -0.02em;
        }

        .btn-primary {
            background: var(--color-accent-primary);
            color: var(--color-text-on-accent);
            border-color: var(--color-accent-primary);
        }

        .btn-primary:hover {
            background: var(--color-accent-hover);
            border-color: var(--color-accent-hover);
        }

        .btn-primary:active {
            background: var(--color-accent-active);
            border-color: var(--color-accent-active);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(33, 33, 33, 0.3);
            border-top-color: var(--color-text-on-accent);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        .spinner-ghost {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(136, 136, 136, 0.3);
            border-top-color: var(--color-text-secondary);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .form-actions {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .form-actions .btn {
            flex: 1;
            min-width: 0;
        }

        .btn-ghost {
            background: transparent;
            color: var(--color-text-secondary);
            border-color: transparent;
        }

        .btn-ghost:hover {
            background: var(--color-bg-hover);
            color: var(--color-text-primary);
            border-color: transparent;
        }

        .btn-ghost:active {
            background: var(--color-bg-active);
        }

        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toast {
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-family: inherit;
            border: 1px solid;
            box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.1);
            animation: toast-slide-in 300ms ease-out;
            max-width: 360px;
            transition: opacity 300ms ease-out, transform 300ms ease-out;
        }

        .toast-success {
            background: var(--color-success-bg);
            border-color: var(--color-success-border);
            color: var(--color-success);
        }

        .toast-error {
            background: var(--color-error-bg);
            border-color: var(--color-error-border);
            color: var(--color-error);
        }

        @keyframes toast-slide-in {
            from { transform: translateY(16px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Tablet */
        @media (max-width: 820px) {
            .logo {
                position: static;
                transform: none;
                margin-bottom: 0;
            }
            body {
                justify-content: flex-start;
                padding: 40px 24px;
                gap: 40px;
            }
        }

        /* Mobile */
        @media (max-width: 550px) {
            body {
                padding: 16px;
                gap: 16px;
            }
            .logo svg:first-child { width: 36px; height: 36px; }
            .logo svg:last-child { width: 100px; height: 17px; }
            .logo { gap: 12px; }
            .login-container {
                padding: 24px;
                gap: 16px;
            }
            .login-header h2 {
                font-size: 24px;
                line-height: 32px;
                letter-spacing: -0.02em;
            }
            .login-header p {
                font-size: 14px;
                line-height: 20px;
            }
            .login-header { gap: 4px; }
            .form-label {
                font-size: 14px;
                line-height: 20px;
            }
            .form-input {
                font-size: 14px;
                line-height: 20px;
            }
            .form-group + .form-group,
            .form-group[style] { margin-top: 16px !important; }
            .form-actions { gap: 16px; margin-top: 16px !important; }
            .btn {
                font-size: 14px;
                line-height: 20px;
                padding: 12px 12px;
            }
        }
    </style>
</head>
<body>
<!-- Logo above card -->
<div class="logo">
    <svg width="48" height="48" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g>
            <path d="M21.3333 16.5333C21.3333 16.2388 21.5721 16 21.8667 16H26.1333C26.4279 16 26.6667 16.2388 26.6667 16.5333V20.8C26.6667 21.0946 26.4279 21.3333 26.1333 21.3333H21.8667C21.5721 21.3333 21.3333 21.0946 21.3333 20.8V16.5333Z" fill="#ffc008"/>
            <path d="M16 21.8667C16 21.5721 16.2388 21.3333 16.5333 21.3333H20.8C21.0946 21.3333 21.3333 21.5721 21.3333 21.8667V26.1333C21.3333 26.4279 21.0946 26.6667 20.8 26.6667H16.5333C16.2388 26.6667 16 26.4279 16 26.1333V21.8667Z" fill="#ffc008"/>
            <path d="M26.6667 21.8667C26.6667 21.5721 26.9054 21.3333 27.2 21.3333H31.4667C31.7612 21.3333 32 21.5721 32 21.8667V26.1333C32 26.4279 31.7612 26.6667 31.4667 26.6667H27.2C26.9054 26.6667 26.6667 26.4279 26.6667 26.1333V21.8667Z" fill="#ffc008"/>
            <path d="M21.3333 27.2C21.3333 26.9054 21.5721 26.6667 21.8667 26.6667H26.1333C26.4279 26.6667 26.6667 26.9054 26.6667 27.2V31.4667C26.6667 31.7612 26.4279 32 26.1333 32H21.8667C21.5721 32 21.3333 31.7612 21.3333 31.4667V27.2Z" fill="#ffc008"/>
            <path d="M30.9333 0H1.06667C0.477563 0 0 0.477564 0 1.06667V30.9333C0 31.5224 0.477563 32 1.06667 32H14.9333C15.5224 32 16 31.5224 16 30.9333V27.7333C16 27.1442 15.5224 26.6667 14.9333 26.6667H5.86667C5.57211 26.6667 5.33333 26.4279 5.33333 26.1333V5.86667C5.33333 5.57211 5.57211 5.33333 5.86667 5.33333H26.1333C26.4279 5.33333 26.6667 5.57212 26.6667 5.86667V14.9333C26.6667 15.5224 27.1442 16 27.7333 16H30.9333C31.5224 16 32 15.5224 32 14.9333V1.06667C32 0.477563 31.5224 0 30.9333 0Z" fill="#fafafa"/>
        </g>
    </svg>
    <svg width="130" height="22" viewBox="0 0 87 15" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g>
            <path d="M5.43109 11.403C4.36371 11.403 3.4219 11.1615 2.60567 10.6785C1.78943 10.1955 1.1511 9.52875 0.690659 8.67825C0.23022 7.81725 0 6.825 0 5.7015C0 4.578 0.23022 3.591 0.690659 2.7405C1.1511 1.8795 1.78943 1.2075 2.60567 0.7245C3.4219 0.2415 4.36371 0 5.43109 0C6.50894 0 7.45598 0.2415 8.27221 0.7245C9.08844 1.2075 9.72155 1.8795 10.1715 2.7405C10.632 3.591 10.8622 4.578 10.8622 5.7015C10.8622 6.825 10.632 7.81725 10.1715 8.67825C9.72155 9.52875 9.08844 10.1955 8.27221 10.6785C7.45598 11.1615 6.50894 11.403 5.43109 11.403ZM5.43109 9.49725C6.10082 9.49725 6.67637 9.345 7.15774 9.0405C7.64957 8.7255 8.03153 8.2845 8.3036 7.7175C8.57568 7.1505 8.71172 6.4785 8.71172 5.7015C8.71172 4.914 8.57568 4.242 8.3036 3.6855C8.03153 3.1185 7.64957 2.68275 7.15774 2.37825C6.67637 2.07375 6.10082 1.9215 5.43109 1.9215C4.77183 1.9215 4.19628 2.07375 3.70444 2.37825C3.21261 2.68275 2.83065 3.1185 2.55858 3.6855C2.2865 4.242 2.15046 4.914 2.15046 5.7015C2.15046 6.4785 2.2865 7.1505 2.55858 7.7175C2.83065 8.2845 3.21261 8.7255 3.70444 9.0405C4.19628 9.345 4.77183 9.49725 5.43109 9.49725Z" fill="#fafafa"/>
            <path d="M12.3091 14.679V3.276H14.1927L14.4282 4.3785C14.5956 4.1475 14.7944 3.9375 15.0246 3.7485C15.2549 3.549 15.5269 3.3915 15.8409 3.276C16.1653 3.15 16.542 3.087 16.9711 3.087C17.714 3.087 18.3681 3.27075 18.9332 3.63825C19.4982 4.00575 19.943 4.5045 20.2674 5.1345C20.6022 5.754 20.7697 6.46275 20.7697 7.26075C20.7697 8.05875 20.6022 8.77275 20.2674 9.40275C19.9325 10.0223 19.4825 10.5105 18.9175 10.8675C18.3524 11.2245 17.7088 11.403 16.9867 11.403C16.4007 11.403 15.8932 11.298 15.4642 11.088C15.0456 10.8675 14.7002 10.5683 14.4282 10.1903V14.679H12.3091ZM16.4845 9.5445C16.903 9.5445 17.2693 9.45 17.5832 9.261C17.9076 9.072 18.1588 8.80425 18.3367 8.45775C18.5146 8.11125 18.6035 7.71225 18.6035 7.26075C18.6035 6.80925 18.5146 6.41025 18.3367 6.06375C18.1588 5.70675 17.9076 5.43375 17.5832 5.24475C17.2693 5.04525 16.903 4.9455 16.4845 4.9455C16.0763 4.9455 15.7101 5.04525 15.3857 5.24475C15.0717 5.43375 14.8206 5.7015 14.6322 6.048C14.4543 6.3945 14.3654 6.7935 14.3654 7.245C14.3654 7.6965 14.4543 8.10075 14.6322 8.45775C14.8206 8.80425 15.0717 9.072 15.3857 9.261C15.7101 9.45 16.0763 9.5445 16.4845 9.5445Z" fill="#fafafa"/>
            <path d="M26.0795 11.403C25.2842 11.403 24.5778 11.235 23.9604 10.899C23.3535 10.5525 22.8773 10.0748 22.532 9.46575C22.1971 8.84625 22.0297 8.13225 22.0297 7.32375C22.0297 6.49425 22.1971 5.7645 22.532 5.1345C22.8773 4.494 23.3535 3.99525 23.9604 3.63825C24.5674 3.27075 25.2737 3.087 26.0795 3.087C26.8643 3.087 27.5498 3.26025 28.1358 3.60675C28.7218 3.95325 29.177 4.4205 29.5014 5.0085C29.8258 5.5965 29.988 6.26325 29.988 7.00875C29.988 7.11375 29.988 7.2345 29.988 7.371C29.988 7.497 29.9775 7.62825 29.9566 7.76475H23.5366V6.47325H27.8532C27.8218 5.95875 27.6387 5.5545 27.3038 5.2605C26.9794 4.9665 26.5713 4.8195 26.0795 4.8195C25.7237 4.8195 25.3941 4.9035 25.0906 5.0715C24.7871 5.229 24.5464 5.47575 24.3685 5.81175C24.2011 6.14775 24.1174 6.573 24.1174 7.0875V7.54425C24.1174 7.97475 24.1959 8.35275 24.3528 8.67825C24.52 8.99325 24.7505 9.24 25.0435 9.4185C25.3365 9.5865 25.6766 9.6705 26.0638 9.6705C26.451 9.6705 26.7701 9.5865 27.0213 9.4185C27.2829 9.2505 27.4765 9.03525 27.6021 8.77275H29.7682C29.6217 9.26625 29.3758 9.7125 29.0305 10.1115C28.6852 10.5105 28.2613 10.8255 27.759 11.0565C27.2567 11.2875 26.6969 11.403 26.0795 11.403Z" fill="#fafafa"/>
            <path d="M31.4095 11.214V3.276H33.2774L33.4344 4.5675C33.6751 4.1265 34.0152 3.7695 34.4547 3.4965C34.9047 3.2235 35.4384 3.087 36.0558 3.087C36.715 3.087 37.2697 3.2235 37.7196 3.4965C38.1696 3.7695 38.5097 4.1685 38.7399 4.6935C38.9806 5.2185 39.101 5.86425 39.101 6.63075V11.214H36.9976V6.8355C36.9976 6.2055 36.8615 5.7225 36.5895 5.3865C36.3279 5.0505 35.9197 4.8825 35.3651 4.8825C35.0093 4.8825 34.6902 4.9665 34.4076 5.1345C34.1355 5.3025 33.921 5.544 33.764 5.859C33.6071 6.1635 33.5286 6.53625 33.5286 6.97725V11.214H31.4095Z" fill="#fafafa"/>
            <path d="M40.8305 11.214V0.188999H47.9883V1.90575H42.9496V4.851H46.9837V6.5205H42.9496V11.214H40.8305Z" fill="#fafafa"/>
            <path d="M49.1917 11.214V3.276H51.0753L51.2793 4.74075C51.4677 4.39425 51.7031 4.10025 51.9857 3.85875C52.2787 3.61725 52.6083 3.42825 52.9746 3.29175C53.3513 3.15525 53.7647 3.087 54.2146 3.087V5.33925H53.4926C53.1786 5.33925 52.8856 5.376 52.6136 5.4495C52.3519 5.523 52.1217 5.64375 51.9229 5.81175C51.7241 5.96925 51.5723 6.18975 51.4677 6.47325C51.363 6.75675 51.3107 7.11375 51.3107 7.54425V11.214H49.1917Z" fill="#fafafa"/>
            <path d="M57.969 11.403C57.3097 11.403 56.7656 11.298 56.3365 11.088C55.9075 10.8675 55.5883 10.5788 55.379 10.2218C55.1802 9.85425 55.0808 9.45 55.0808 9.009C55.0808 8.526 55.2011 8.10075 55.4418 7.73325C55.693 7.36575 56.0644 7.077 56.5563 6.867C57.0586 6.657 57.6864 6.552 58.4399 6.552H60.402C60.402 6.1635 60.3497 5.84325 60.245 5.59125C60.1404 5.32875 59.9782 5.1345 59.7584 5.0085C59.5387 4.8825 59.2457 4.8195 58.8794 4.8195C58.4817 4.8195 58.1417 4.90875 57.8591 5.08725C57.587 5.25525 57.4196 5.51775 57.3568 5.87475H55.3005C55.3529 5.30775 55.536 4.8195 55.8499 4.41C56.1743 3.99 56.5981 3.6645 57.1214 3.4335C57.655 3.2025 58.2463 3.087 58.8951 3.087C59.6381 3.087 60.2816 3.213 60.8258 3.465C61.37 3.717 61.7885 4.07925 62.0815 4.55175C62.3746 5.02425 62.5211 5.607 62.5211 6.3V11.214H60.7316L60.4962 10.0013C60.3811 10.2113 60.245 10.4003 60.0881 10.5683C59.9311 10.7363 59.748 10.8833 59.5387 11.0093C59.3294 11.1353 59.0939 11.2298 58.8323 11.2928C58.5707 11.3663 58.2829 11.403 57.969 11.403ZM58.4713 9.765C58.7434 9.765 58.984 9.71775 59.1933 9.62325C59.4131 9.51825 59.6015 9.38175 59.7584 9.21375C59.9154 9.03525 60.0357 8.83575 60.1194 8.61525C60.2136 8.38425 60.2764 8.1375 60.3078 7.875V7.85925H58.691C58.3666 7.85925 58.0998 7.90125 57.8905 7.98525C57.6917 8.05875 57.5452 8.169 57.451 8.316C57.3568 8.463 57.3097 8.631 57.3097 8.82C57.3097 9.03 57.3568 9.20325 57.451 9.33975C57.5452 9.47625 57.6812 9.58125 57.8591 9.65475C58.037 9.72825 58.2411 9.765 58.4713 9.765Z" fill="#fafafa"/>
            <path d="M64.1839 11.214V3.276H66.0519L66.2245 4.33125C66.4757 3.95325 66.8053 3.654 67.2134 3.4335C67.632 3.2025 68.1081 3.087 68.6418 3.087C69.0395 3.087 69.3953 3.1395 69.7092 3.2445C70.0231 3.3495 70.3005 3.50175 70.5411 3.70125C70.7923 3.90075 70.9963 4.15275 71.1533 4.45725C71.4463 4.02675 71.8283 3.69075 72.2992 3.44925C72.7701 3.20775 73.2828 3.087 73.8375 3.087C74.5281 3.087 75.1037 3.22875 75.5641 3.51225C76.0246 3.78525 76.3699 4.18425 76.6001 4.70925C76.8408 5.23425 76.9611 5.88 76.9611 6.6465V11.214H74.8578V6.8355C74.8578 6.2055 74.7322 5.7225 74.481 5.3865C74.2404 5.0505 73.8636 4.8825 73.3509 4.8825C73.016 4.8825 72.7178 4.9665 72.4561 5.1345C72.1945 5.3025 71.9905 5.544 71.844 5.859C71.7079 6.174 71.6399 6.552 71.6399 6.993V11.214H69.5208V6.8355C69.5208 6.2055 69.3953 5.7225 69.1441 5.3865C68.893 5.0505 68.5058 4.8825 67.9826 4.8825C67.6582 4.8825 67.3652 4.9665 67.1035 5.1345C66.8524 5.3025 66.6536 5.544 66.5071 5.859C66.371 6.174 66.303 6.552 66.303 6.993V11.214H64.1839Z" fill="#fafafa"/>
            <path d="M82.4457 11.403C81.6504 11.403 80.944 11.235 80.3266 10.899C79.7197 10.5525 79.2435 10.0748 78.8982 9.46575C78.5633 8.84625 78.3959 8.13225 78.3959 7.32375C78.3959 6.49425 78.5633 5.7645 78.8982 5.1345C79.2435 4.494 79.7197 3.99525 80.3266 3.63825C80.9336 3.27075 81.6399 3.087 82.4457 3.087C83.2305 3.087 83.9159 3.26025 84.502 3.60675C85.088 3.95325 85.5432 4.4205 85.8676 5.0085C86.192 5.5965 86.3542 6.26325 86.3542 7.00875C86.3542 7.11375 86.3542 7.2345 86.3542 7.371C86.3542 7.497 86.3437 7.62825 86.3228 7.76475H79.9028V6.47325H84.2194C84.188 5.95875 84.0049 5.5545 83.67 5.2605C83.3456 4.9665 82.9375 4.8195 82.4457 4.8195C82.0899 4.8195 81.7603 4.9035 81.4568 5.0715C81.1533 5.229 80.9126 5.47575 80.7347 5.81175C80.5673 6.14775 80.4836 6.573 80.4836 7.0875V7.54425C80.4836 7.97475 80.5621 8.35275 80.719 8.67825C80.8865 8.99325 81.1167 9.24 81.4097 9.4185C81.7027 9.5865 82.0428 9.6705 82.43 9.6705C82.8172 9.6705 83.1363 9.5865 83.3875 9.4185C83.6491 9.2505 83.8427 9.03525 83.9683 8.77275H86.1344C85.9879 9.26625 85.742 9.7125 85.3967 10.1115C85.0513 10.5105 84.6275 10.8255 84.1252 11.0565C83.6229 11.2875 83.0631 11.403 82.4457 11.403Z" fill="#fafafa"/>
        </g>
    </svg>
</div>

<div class="login-container">
    <div class="login-header">
        <h2>OpenFrame Single Sign-On</h2>
        <p>Enter your email and password to access your organization.</p>
    </div>

    <!-- Local Authentication Form -->
    <form id="loginForm" th:action="@{/login}" method="post" autocomplete="on">
        <div class="form-group">
            <label class="form-label" for="username">Email</label>
            <div class="input-wrapper">
                <input type="text" id="username" name="username" class="form-input"
                       placeholder="Enter your email" autocomplete="username">
            </div>
        </div>

        <div class="form-group" style="margin-top: 24px;">
            <label class="form-label" for="password">Password</label>
            <div class="input-wrapper">
                <input type="password" id="password" name="password" class="form-input has-toggle"
                       placeholder="Enter your password" autocomplete="current-password">
                <button type="button" class="password-toggle" id="passwordToggle" aria-label="Show password">
                    <!-- Eye icon -->
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="eyeIcon">
                        <path d="M1 12C1 12 5 4 12 4C19 4 23 12 23 12C23 12 19 20 12 20C5 20 1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <!-- Eye-off icon (hidden by default) -->
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" id="eyeOffIcon" style="display: none;">
                        <path d="M17.94 17.94C16.2306 19.243 14.1491 19.9649 12 20C5 20 1 12 1 12C2.24389 9.68192 3.96914 7.65663 6.06 6.06M9.9 4.24C10.5883 4.07888 11.2931 3.99834 12 4C19 4 23 12 23 12C22.393 13.1356 21.6691 14.2048 20.84 15.19M14.12 14.12C13.8454 14.4148 13.5141 14.6512 13.1462 14.8151C12.7782 14.9791 12.3809 15.0673 11.9781 15.0744C11.5753 15.0815 11.1752 15.0074 10.8016 14.8565C10.4281 14.7056 10.0887 14.4811 9.80385 14.1962C9.51897 13.9113 9.29439 13.5719 9.14351 13.1984C8.99262 12.8248 8.91853 12.4247 8.92563 12.0219C8.93274 11.6191 9.02091 11.2218 9.18488 10.8538C9.34884 10.4859 9.58525 10.1546 9.88 9.88" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M1 1L23 23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="form-actions" style="margin-top: 24px;">
            <button th:if="${passwordResetUrl}" type="button" class="btn btn-ghost" id="forgotPasswordBtn"
                    th:data-url="${passwordResetUrl}">
                <span id="forgotBtnText">Forgot Password?</span>
                <span id="forgotBtnSpinner" class="spinner-ghost" style="display: none;"></span>
            </button>
            <button type="submit" id="submitBtn" class="btn btn-primary">
                <span id="btnText">Continue</span>
                <span id="btnSpinner" class="spinner" style="display: none;"></span>
            </button>
        </div>
    </form>
</div>
<div id="toastContainer" class="toast-container"></div>

<!-- Server-rendered error message shown as toast -->
<script th:if="${errorMessage}" th:inline="javascript">
    (function() {
        var msg = /*[[${errorMessage}]]*/ '';
        if (msg) {
            setTimeout(function() {
                var container = document.getElementById('toastContainer');
                var toast = document.createElement('div');
                toast.className = 'toast toast-error';
                toast.textContent = msg;
                container.appendChild(toast);
                setTimeout(function () {
                    toast.style.opacity = '0';
                    toast.style.transform = 'translateY(16px)';
                    setTimeout(function () { toast.remove(); }, 300);
                }, 4000);
            }, 100);
        }
    })();
</script>

<script>
    (function () {
        var form = document.getElementById('loginForm');
        var submitBtn = document.getElementById('submitBtn');
        var submitText = document.getElementById('btnText');
        var submitSpinner = document.getElementById('btnSpinner');
        var forgotBtn = document.getElementById('forgotPasswordBtn');
        var forgotText = document.getElementById('forgotBtnText');
        var forgotSpinner = document.getElementById('forgotBtnSpinner');
        var passwordInput = document.getElementById('password');
        var passwordToggle = document.getElementById('passwordToggle');
        var eyeIcon = document.getElementById('eyeIcon');
        var eyeOffIcon = document.getElementById('eyeOffIcon');

        // Password visibility toggle
        if (passwordToggle) {
            passwordToggle.addEventListener('click', function () {
                var isPassword = passwordInput.type === 'password';
                passwordInput.type = isPassword ? 'text' : 'password';
                eyeIcon.style.display = isPassword ? 'none' : '';
                eyeOffIcon.style.display = isPassword ? '' : 'none';
                passwordToggle.setAttribute('aria-label', isPassword ? 'Hide password' : 'Show password');
            });
        }

        function setGlobalLoading(loading, source) {
            submitBtn.disabled = loading;
            if (forgotBtn) forgotBtn.disabled = loading;

            if (source === 'submit') {
                submitText.textContent = loading ? 'Signing in...' : 'Continue';
                submitSpinner.style.display = loading ? '' : 'none';
            } else if (source === 'forgot') {
                if (forgotSpinner) forgotSpinner.style.display = loading ? '' : 'none';
            }
        }

        function showToast(message, variant) {
            var container = document.getElementById('toastContainer');
            var toast = document.createElement('div');
            toast.className = 'toast toast-' + variant;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(function () {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(16px)';
                setTimeout(function () { toast.remove(); }, 300);
            }, 4000);
        }

        // Forgot password handler
        if (forgotBtn) {
            forgotBtn.addEventListener('click', function () {
                var email = document.getElementById('username').value.trim();
                if (!email) {
                    showToast('Please enter your email address first.', 'error');
                    return;
                }
                setGlobalLoading(true, 'forgot');
                var url = forgotBtn.getAttribute('data-url');
                fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email })
                }).then(function (res) {
                    if (res.ok || res.status === 202) {
                        showToast('Password reset email sent. Check your inbox.', 'success');
                    } else {
                        showToast('Could not send password reset email. Please try again.', 'error');
                    }
                    setGlobalLoading(false, 'forgot');
                }).catch(function () {
                    showToast('Network error. Please try again.', 'error');
                    setGlobalLoading(false, 'forgot');
                });
            });
        }

        // Login form submit handler
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            setGlobalLoading(true, 'submit');

            fetch(form.action, {
                method: 'POST',
                body: new URLSearchParams(new FormData(form)),
                redirect: 'follow',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            }).then(function (res) {
                if (res.redirected) {
                    window.location.href = res.url;
                    return;
                }
                return res.text().then(function (html) {
                    var doc = new DOMParser().parseFromString(html, 'text/html');
                    var errScript = doc.querySelector('script[th\\:if]');
                    var errEl = doc.querySelector('.toast-error');
                    var errText = errEl ? errEl.textContent : null;
                    if (!errText) {
                        var alertEl = doc.querySelector('.alert-error');
                        errText = alertEl ? alertEl.textContent : null;
                    }
                    showToast(errText || 'Authentication failed', 'error');
                    setGlobalLoading(false, 'submit');
                });
            }).catch(function () {
                showToast('Network error. Please try again.', 'error');
                setGlobalLoading(false, 'submit');
            });
        });
    })();
</script>
</body>
</html>