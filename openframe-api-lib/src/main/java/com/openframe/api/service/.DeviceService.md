<!-- source-hash: 8cde365bde263d2686c29159ab39c15d -->
Service class that provides device management operations in the OpenFrame API, handling device querying with advanced filtering, pagination, and CRUD operations for machine entities.

## Key Components

- **findByMachineId()** - Retrieves a single device by its machine ID
- **queryDevices()** - Advanced device querying with filtering, pagination, search, and sorting capabilities
- **softDeleteByMachineId()** - Marks a device as deleted without physical removal
- **updateStatusByMachineId()** - Updates device status with post-processing hooks
- **buildDeviceQuery()** - Constructs MongoDB queries from filter criteria and tag resolution
- **fetchPageItems()** - Implements cursor-based pagination for device listings
- **validateSortField()** - Ensures only valid sortable fields are used in queries

## Usage Example

```java
@RestController
@RequiredArgsConstructor
public class DeviceController {
    
    private final DeviceService deviceService;
    
    @GetMapping("/devices/{machineId}")
    public ResponseEntity<Machine> getDevice(@PathVariable String machineId) {
        return deviceService.findByMachineId(machineId)
            .map(ResponseEntity::ok)
            .orElse(ResponseEntity.notFound().build());
    }
    
    @GetMapping("/devices")
    public CountedGenericQueryResult<Machine> queryDevices(
            @RequestParam(required = false) List<DeviceStatus> statuses,
            @RequestParam(defaultValue = "10") int limit,
            @RequestParam(required = false) String search) {
        
        DeviceFilterOptions filter = DeviceFilterOptions.builder()
            .statuses(statuses)
            .build();
            
        CursorPaginationCriteria pagination = CursorPaginationCriteria.builder()
            .limit(limit)
            .build();
            
        return deviceService.queryDevices(filter, pagination, search, null);
    }
    
    @PutMapping("/devices/{machineId}/status")
    public void updateDeviceStatus(@PathVariable String machineId, 
                                  @RequestBody DeviceStatus newStatus) {
        deviceService.updateStatusByMachineId(machineId, newStatus);
    }
}
```