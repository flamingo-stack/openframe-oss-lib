<!-- source-hash: 1c515f406ff281130a762f735441ad73 -->
A Spring Data MongoDB repository interface for managing API key persistence operations with user-scoped access control and expiration tracking.

## Key Components

- **ApiKeyRepository** - Main repository interface extending `MongoRepository` and `BaseApiKeyRepository`
- **findByIdAndUserId()** - Custom query method to find API keys by ID and user ID with MongoDB query annotation
- **findByIdAndUserIdOrElseThrow()** - Convenience method that throws `ApiKeyNotFoundException` if key not found
- **findByUserId()** - Retrieves all API keys for a specific user
- **findExpiredKeys()** - Custom query to find expired but enabled API keys using MongoDB date comparison

## Usage Example

```java
@Service
public class ApiKeyService {
    
    @Autowired
    private ApiKeyRepository apiKeyRepository;
    
    public ApiKey getUserApiKey(String keyId, String userId) {
        // Throws ApiKeyNotFoundException if not found
        return apiKeyRepository.findByIdAndUserIdOrElseThrow(keyId, userId);
    }
    
    public List<ApiKey> getAllUserKeys(String userId) {
        return apiKeyRepository.findByUserId(userId);
    }
    
    public void cleanupExpiredKeys() {
        List<ApiKey> expiredKeys = apiKeyRepository.findExpiredKeys(Instant.now());
        // Process expired keys for cleanup
    }
}
```

The repository is conditionally enabled only for servlet-based web applications and uses MongoDB's native query syntax for optimized database operations.