<!-- source-hash: c3eac3c1fc5f7dad83f7704974c43c65 -->
This MongoDB document entity represents OAuth2 authorization data with automatic TTL-based cleanup and optimized indexing for Spring Security OAuth2 flows.

## Key Components

- **@Document**: Maps to `oauth2_authorizations` collection with compound index on client ID and principal
- **Token Fields**: Stores authorization code, access token, and refresh token values with timestamps and metadata
- **Authorization Request**: Minimal PKCE-compatible snapshot fields (`ar*` prefix) avoiding complex objects
- **TTL Management**: `updateExpiresAt()` method sets automatic document expiration based on latest token expiry
- **Indexes**: Strategic indexing on frequently queried fields (client ID, principal, state, token values)

## Usage Example

```java
@Service
public class OAuth2AuthorizationService {
    
    @Autowired
    private MongoTemplate mongoTemplate;
    
    public void saveAuthorization(MongoOAuth2Authorization auth) {
        // Set TTL expiration before saving
        auth.updateExpiresAt();
        mongoTemplate.save(auth);
    }
    
    public MongoOAuth2Authorization findByState(String state) {
        Query query = new Query(Criteria.where("state").is(state));
        return mongoTemplate.findOne(query, MongoOAuth2Authorization.class);
    }
    
    public void removeExpiredTokens() {
        // TTL index handles this automatically
        // Documents expire when expiresAt timestamp is reached
    }
}
```