<!-- source-hash: b80f4a76853de0e342d8878f295e53be -->
This Spring Boot component listens to NATS JetStream messages about agent installations on remote machines and processes them to update the local agent registry.

## Key Components

- **InstalledAgentListener**: Main Spring component that subscribes to NATS JetStream for installed agent notifications
- **subscribeToInstalledAgents()**: Event listener that initializes JetStream subscription on application startup
- **buildConsumerConfig()**: Creates or updates NATS consumer configuration with retry and acknowledgment settings
- **handleMessage()**: Processes incoming messages by extracting machine ID, parsing agent details, and updating the service
- **cleanup()**: PreDestroy method that gracefully shuts down subscriptions and dispatchers

## Usage Example

The listener automatically starts when the Spring application is ready:

```java
// The component is automatically registered and started by Spring
@Component
public class InstalledAgentListener {
    
    // Processes messages from subject pattern: "machine.*.installed-agent"
    private void handleMessage(Message message) {
        String machineId = machineIdExtractor.extract(subject);
        InstalledAgentMessage agentMsg = objectMapper.readValue(payload, InstalledAgentMessage.class);
        
        installedAgentService.addInstalledAgent(
            machineId, 
            agentMsg.getAgentType(), 
            agentMsg.getVersion(), 
            isLastAttempt
        );
        
        message.ack(); // Acknowledge successful processing
    }
}
```

The listener uses explicit acknowledgment with retry logic (max 50 deliveries, 30-second ack timeout) and automatically handles consumer creation/updates for the "INSTALLED_AGENTS" stream.