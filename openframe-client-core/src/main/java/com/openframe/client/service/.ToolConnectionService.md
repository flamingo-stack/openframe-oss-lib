<!-- source-hash: b36b4baf19b5a67a0ae7f73e794479c6 -->
Manages tool connections between agents and machines, handling connection lifecycle and status updates with validation and data transformation.

## Key Components

**Main Method:**
- `addToolConnection()` - Creates or updates tool connections with validation and status management

**Private Methods:**
- `processExistingToolConnection()` - Handles updates to existing connections (reconnection, agent ID changes)
- `addNewToolConnection()` - Creates new tool connection records
- `validateAgentId()`, `validateToolType()`, `validateMachineExists()` - Input validation methods
- `getToolTypeFromString()` - Converts string to ToolType enum

**Dependencies:**
- `ToolConnectionRepository` - Data persistence
- `MachineRepository` - Machine validation
- `ToolAgentIdTransformerService` - ID transformation logic

## Usage Example

```java
@Autowired
private ToolConnectionService toolConnectionService;

// Add a new tool connection
toolConnectionService.addToolConnection(
    "agent-123", 
    "SCANNER", 
    "scanner-tool-456", 
    true
);

// The service will:
// 1. Validate agent ID, tool type, and machine existence
// 2. Check for existing connections
// 3. Either create new connection or update existing one
// 4. Handle connection status (CONNECTED/DISCONNECTED)
// 5. Transform and store agent tool ID
```

The service ensures data integrity through comprehensive validation and maintains connection state consistency across reconnections and ID updates.