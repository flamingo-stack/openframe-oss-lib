<!-- source-hash: c9e4a5820d0e9ac9749a06013212c218 -->
This service handles the complete registration process for OpenFrame agents, managing OAuth client creation, machine registration, and organization assignment in a transactional workflow.

## Key Components

### Main Methods
- `register()` - Core registration method that orchestrates the entire agent registration process
- `resolveOrganizationId()` - Determines which organization the agent should belong to, with fallback to default
- `getDefaultOrganizationId()` - Retrieves the default organization ID for fallback scenarios

### Core Dependencies
- `AgentRegistrationSecretValidator` - Validates initial registration keys
- `AgentSecretGenerator` & `MachineIdGenerator` - Generate secure credentials and unique identifiers
- `AgentRegistrationProcessor` - Handles post-registration processing
- `AgentRegistrationToolInstallationService` - Manages tool installation during registration

### Data Management
- Creates OAuth clients with client credentials grant type and AGENT role
- Saves machine records with PENDING status and DESKTOP device type
- Handles organization assignment with intelligent fallback logic

## Usage Example

```java
@Autowired
private AgentRegistrationService registrationService;

// Register a new agent
AgentRegistrationRequest request = AgentRegistrationRequest.builder()
    .hostname("workstation-01")
    .ip("192.168.1.100")
    .macAddress("00:11:22:33:44:55")
    .osType("Windows")
    .osUuid("uuid-123")
    .agentVersion("1.0.0")
    .organizationId("org-123") // Optional - falls back to default
    .build();

AgentRegistrationResponse response = registrationService.register(
    "initial-secret-key", 
    request
);

// Response contains: machineId, clientId, clientSecret
String machineId = response.getMachineId();
```

The service ensures secure registration with proper validation, unique ID generation, and maintains data consistency through Spring's `@Transactional` annotation.