<!-- source-hash: 2b7fe2cc82d90d90d73611619e1517eb -->
A Spring service responsible for managing the installation and versioning of agents on registered machines. It handles both creating new agent installations and updating existing ones with comprehensive validation.

## Key Components

- **`addInstalledAgent()`** - Main transactional method that processes agent installation/updates
- **`updateExistingInstalledAgent()`** - Updates version and timestamp for existing agent installations
- **`addNewInstalledAgent()`** - Creates new `InstalledAgent` records with timestamps
- **Validation methods** - `validateMachineExists()`, `validateMachineId()`, `validateAgentType()`
- **Repository dependencies** - `InstalledAgentRepository` for agent data, `MachineRepository` for machine validation

## Usage Example

```java
@Autowired
private InstalledAgentService installedAgentService;

// Install or update an agent on a machine
public void deployAgent(String machineId, String agentType, String version) {
    try {
        installedAgentService.addInstalledAgent(machineId, agentType, version, false);
        log.info("Agent {} version {} successfully deployed to machine {}", 
                agentType, version, machineId);
    } catch (MachineNotFoundException e) {
        log.error("Cannot deploy agent - machine not found: {}", machineId);
    } catch (InvalidAgentIdException e) {
        log.error("Invalid machine ID provided: {}", e.getMessage());
    }
}
```

The service automatically determines whether to create a new installation record or update an existing one based on the machine-agent combination, ensuring proper audit trails with creation and update timestamps.