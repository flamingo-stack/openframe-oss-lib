<!-- source-hash: 2b7fe2cc82d90d90d73611619e1517eb -->
A Spring service that manages installed agent records for machines, handling both new installations and version updates with proper validation and transactional support.

## Key Components

- **addInstalledAgent()** - Main transactional method that processes agent installations by either updating existing records or creating new ones
- **updateExistingInstalledAgent()** - Updates version and timestamp for existing agent installations
- **addNewInstalledAgent()** - Creates new InstalledAgent records with current timestamps
- **Validation methods** - validateMachineExists(), validateMachineId(), validateAgentType() ensure data integrity
- **Dependencies** - InstalledAgentRepository and MachineRepository for data access

## Usage Example

```java
@Autowired
private InstalledAgentService installedAgentService;

// Register a new agent installation
installedAgentService.addInstalledAgent(
    "machine-123", 
    "monitoring-agent", 
    "v2.1.0", 
    false
);

// Update existing agent version
installedAgentService.addInstalledAgent(
    "machine-123", 
    "monitoring-agent", 
    "v2.2.0", 
    true
);
```

The service automatically handles duplicate detection, validates machine existence, and maintains audit timestamps for all operations.