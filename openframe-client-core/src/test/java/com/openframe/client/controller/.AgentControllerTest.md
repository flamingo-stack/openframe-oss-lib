<!-- source-hash: d8467ad6af45bc7382851b07c51667ed -->
Test suite for AgentController that validates agent registration endpoints, including authentication, validation, and error handling scenarios.

## Key Components

**Test Class**: `AgentControllerTest`
- Tests agent registration API endpoint `/api/agents/register`
- Validates authentication via `X-Initial-Key` header
- Covers error scenarios (missing headers, invalid keys, duplicates)
- Uses MockMvc for integration-style testing with mocked services

**Mocked Dependencies**:
- `AgentRegistrationService` - Core registration logic
- `TestAuthenticationManager` - Custom auth for testing
- `GlobalExceptionHandler` - Exception handling validation

**Test Data Objects**:
- `AgentRegistrationRequest` - Input with hostname, IP, MAC address, OS UUID, agent version
- `AgentRegistrationResponse` - Output with machine ID and OAuth credentials

## Usage Example

```java
// Example test structure for similar controller tests
@ExtendWith(MockitoExtension.class)
class MyControllerTest {
    
    @Mock
    private MyService myService;
    
    private MockMvc mockMvc;
    
    @BeforeEach
    void setup() {
        MyController controller = new MyController(myService);
        mockMvc = MockMvcBuilders.standaloneSetup(controller)
                .addFilter(new BasicAuthenticationFilter(new TestAuthenticationManager()))
                .setControllerAdvice(new GlobalExceptionHandler())
                .build();
    }
    
    @Test
    void testValidRequest() throws Exception {
        when(myService.process(any())).thenReturn(expectedResponse);
        
        mockMvc.perform(post("/api/endpoint")
                        .header("X-Custom-Header", "value")
                        .contentType(MediaType.APPLICATION_JSON)
                        .content(jsonContent))
                .andExpect(status().isOk())
                .andExpect(jsonPath("$.field").value("expected"));
    }
}
```