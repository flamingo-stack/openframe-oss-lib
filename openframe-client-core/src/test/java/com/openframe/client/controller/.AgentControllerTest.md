<!-- source-hash: d8467ad6af45bc7382851b07c51667ed -->
This file contains JUnit tests for the `AgentController` class, specifically testing the agent registration endpoint functionality using MockMvc and Mockito.

## Key Components

- **Test Setup**: MockMvc configuration with authentication filters and exception handlers
- **Test Data**: Pre-configured `AgentRegistrationRequest` and `AgentRegistrationResponse` objects
- **Registration Tests**: Comprehensive test coverage for various registration scenarios
- **Mock Service**: Mocked `AgentRegistrationService` for isolated controller testing

## Usage Example

```java
// Example test structure for agent registration
@Test
void register_WithValidRequest_ReturnsOk() throws Exception {
    // Mock service response
    when(agentRegistrationService.register(any(), any()))
        .thenReturn(registrationResponse);

    // Perform POST request with authentication header
    mockMvc.perform(post("/api/agents/register")
            .header("X-Initial-Key", "test-key")
            .contentType(MediaType.APPLICATION_JSON)
            .content(objectMapper.writeValueAsString(registrationRequest)))
        .andExpect(status().isOk())
        .andExpected(jsonPath("$.machineId").value("test-machine-id"));
}
```

The tests cover successful registration, missing headers, invalid credentials, duplicate registrations, and proper data storage verification. Each test isolates specific scenarios to ensure robust controller behavior validation.