sequenceDiagram
    participant Admin as Organization Admin
    participant Controller as SsoDiscoveryController
    participant Strategy as Google/MicrosoftClientRegistrationStrategy
    participant Provider as Google/Microsoft OAuth2 API
    participant AuthService as MongoAuthorizationService
    participant KeyService as TenantKeyService
    participant TenantCtx as TenantContext

    Admin->>Controller: Initiate SSO registration
    Controller->>Strategy: Prepare client registration
    Strategy->>KeyService: Fetch tenant keys
    Strategy->>Provider: Register client (API call)
    Provider-->>Strategy: Return client credentials
    Strategy->>AuthService: Persist client registration
    Strategy->>TenantCtx: Update tenant SSO config
    Controller-->>Admin: Return registration result