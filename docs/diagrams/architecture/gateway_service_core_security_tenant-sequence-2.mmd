sequenceDiagram
    participant Client
    participant Gateway
    participant AuthFilter as ApiKeyAuthenticationFilter
    participant SecurityConfig
    participant IssuerUrlProvider
    participant TenantRepository

    Client->>Gateway: HTTP Request (with tenant info)
    Gateway->>AuthFilter: Pass request
    AuthFilter->>SecurityConfig: Authenticate & authorize
    SecurityConfig->>IssuerUrlProvider: Request issuer URL for tenant
    IssuerUrlProvider->>TenantRepository: Lookup issuer URL
    TenantRepository-->>IssuerUrlProvider: Return issuer URL
    IssuerUrlProvider-->>SecurityConfig: Return issuer URL
    SecurityConfig-->>AuthFilter: Continue authentication
    AuthFilter-->>Gateway: Allow/deny request
    Gateway-->>Client: Response