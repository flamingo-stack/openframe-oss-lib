flowchart TD
    subgraph EventBus["Event Bus / Message Broker"]
        A1["Client Connection Event"]
        A2["Agent Installed Event"]
        A3["Machine Heartbeat Event"]
        A4["Tool Connection Event"]
    end

    subgraph Listeners["client_core_listener"]
        B1["ClientConnectionListener"]
        B2["InstalledAgentListener"]
        B3["MachineHeartbeatListener"]
        B4["ToolConnectionListener"]
    end

    subgraph Services["Service Layer"]
        C1["AgentRegistrationProcessor"]
        C2["AgentIdTransformer"]
        C3["AgentService"]
        C4["ToolConnectionService"]
    end

    A1 --> B1
    A2 --> B2
    A3 --> B3
    A4 --> B4

    B1 -->|updates| C3
    B2 -->|triggers| C1
    B2 -->|transforms| C2
    B4 -->|notifies| C4