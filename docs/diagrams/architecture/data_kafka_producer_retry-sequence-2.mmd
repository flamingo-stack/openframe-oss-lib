sequenceDiagram
    participant App as "Producer Application"
    participant Producer as "Kafka Producer"
    participant Handler as "KafkaRecoveryHandlerImpl"
    participant Broker as "Kafka Broker"
    App->>Producer: Send message
    Producer->>Broker: Send message
    alt Failure
        Producer->>Handler: Notify failure
        Handler->>Producer: Retry send
        loop Until success or max retries
            Producer->>Broker: Retry send
            alt Success
                Producer->>App: Ack success
            else Failure
                Handler->>App: Invoke recovery callback
            end
        end
    else Success
        Producer->>App: Ack success
    end