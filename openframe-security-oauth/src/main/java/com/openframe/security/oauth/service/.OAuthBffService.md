<!-- source-hash: 0bae9a3097f7dea3f1fee3fc7112bfcd -->
Service that implements OAuth 2.0 Backend-for-Frontend (BFF) pattern for OpenFrame's multi-tenant authentication system, handling authorization flows, token management, and PKCE security.

## Key Components

- **buildAuthorizeRedirect()** - Creates OAuth authorization URL with PKCE challenge and state management
- **handleCallback()** - Processes OAuth callback, validates state, and exchanges authorization code for tokens
- **refreshTokensPublic()/refreshTokensByLookup()** - Refreshes access tokens using refresh tokens, with tenant resolution
- **revokeRefreshToken()/revokeRefreshTokenByLookup()** - Revokes refresh tokens for secure logout
- **AuthorizeData/OAuthSessionData** - Internal data structures for OAuth flow state management

## Usage Example

```java
@Autowired
private OAuthBffService oauthService;

// 1. Start OAuth flow
@GetMapping("/oauth/authorize")
public Mono<ResponseEntity<Object>> authorize(
    @RequestParam String tenantId,
    @RequestParam(required = false) String redirectTo,
    ServerHttpRequest request) {
    
    return oauthService.buildAuthorizeRedirect(tenantId, redirectTo, "google", request)
        .map(authData -> {
            // Store session data in secure cookie
            String cookieName = "of_oauth_" + authData.state();
            // Redirect to OAuth provider
            return ResponseEntity.status(302)
                .location(URI.create(authData.authorizeUrl()))
                .build();
        });
}

// 2. Handle OAuth callback
@GetMapping("/oauth/callback")
public Mono<ResponseEntity<Object>> callback(
    @RequestParam String code,
    @RequestParam String state,
    ServerHttpRequest request) {
    
    return oauthService.handleCallback(code, state, request)
        .map(result -> ResponseEntity.ok(result.tokens()));
}

// 3. Refresh tokens without tenant lookup
@PostMapping("/oauth/refresh")
public Mono<TokenResponse> refresh(
    @RequestParam String refreshToken,
    ServerHttpRequest request) {
    
    return oauthService.refreshTokensByLookup(refreshToken, request);
}
```

The service integrates with Spring Security OAuth2, uses PKCE for enhanced security, and supports multi-tenant scenarios through dynamic tenant resolution from MongoDB authorization records.