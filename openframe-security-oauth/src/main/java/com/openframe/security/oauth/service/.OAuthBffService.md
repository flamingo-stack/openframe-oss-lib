<!-- source-hash: 214a5ad269a9df035a0443c69284db94 -->
This service implements OAuth 2.0 Backend-for-Frontend (BFF) authentication flow with PKCE support, handling authorization, token exchange, refresh, and session management for multi-tenant applications.

## Key Components

- **buildAuthorizeRedirect()** - Creates OAuth authorization URL with PKCE parameters and state management
- **handleCallback()** - Processes OAuth callback, validates state, and exchanges authorization code for tokens
- **refreshTokensPublic()** - Handles token refresh using refresh tokens
- **revokeRefreshToken()** - Revokes refresh tokens during logout
- **buildStateJwt()** - Creates JWT-based state tokens for secure session tracking
- **AuthorizeData** - Record containing authorization URL and session data
- **OAuthSessionData** - Internal record for managing OAuth session state

## Usage Example

```java
@RestController
public class AuthController {
    
    @Autowired
    private OAuthBffService oauthService;
    
    @GetMapping("/auth/login")
    public Mono<ResponseEntity<Void>> login(
            @RequestParam String tenantId,
            @RequestParam(required = false) String redirectTo,
            ServerHttpRequest request) {
        
        return oauthService.buildAuthorizeRedirect(tenantId, redirectTo, null, request)
                .map(data -> {
                    String stateJwt = oauthService.buildStateJwt(data, 600);
                    ResponseCookie cookie = ResponseCookie.from("of_oauth_" + data.state(), stateJwt)
                            .httpOnly(true)
                            .secure(true)
                            .maxAge(600)
                            .build();
                    
                    return ResponseEntity.status(HttpStatus.FOUND)
                            .header(HttpHeaders.LOCATION, data.authorizeUrl())
                            .header(HttpHeaders.SET_COOKIE, cookie.toString())
                            .build();
                });
    }
    
    @GetMapping("/auth/callback")
    public Mono<ResponseEntity<Void>> callback(
            @RequestParam String code,
            @RequestParam String state,
            ServerHttpRequest request) {
        
        return oauthService.handleCallback(code, state, request)
                .map(result -> ResponseEntity.status(HttpStatus.FOUND)
                        .header(HttpHeaders.LOCATION, result.redirectTarget())
                        .build());
    }
}
```