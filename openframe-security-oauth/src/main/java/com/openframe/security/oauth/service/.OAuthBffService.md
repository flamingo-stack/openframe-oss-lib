<!-- source-hash: 4f0a3cdeec04592f19a886cbb3a6983c -->
A comprehensive Spring service implementing Backend-for-Frontend (BFF) OAuth2 authentication flow with PKCE security and multi-tenant support. This service handles the complete OAuth cycle from authorization URL generation to token exchange and refresh operations.

## Key Components

- **buildAuthorizeRedirect()** - Generates OAuth authorization URLs with PKCE parameters and state management
- **handleCallback()** - Processes OAuth callbacks, validates state, and exchanges authorization codes for tokens
- **exchangeCodeForTokens()** - Performs secure token exchange using authorization code and PKCE verifier
- **refreshTokensPublic()** - Handles token refresh operations for expired access tokens
- **revokeRefreshToken()** - Revokes refresh tokens during logout or security cleanup
- **buildStateJwt()** - Creates secure JWT tokens for OAuth state management in cookies
- **AuthorizeData** - Record containing authorization flow parameters (URL, state, code verifier, tenant ID)

## Usage Example

```java
@RestController
public class AuthController {
    
    @Autowired
    private OAuthBffService oauthService;
    
    // Initiate OAuth flow
    @GetMapping("/oauth/authorize")
    public Mono<ResponseEntity<Void>> authorize(
            @RequestParam String tenantId,
            @RequestParam(required = false) String redirectTo,
            ServerHttpRequest request) {
        
        return oauthService.buildAuthorizeRedirect(tenantId, redirectTo, "google", request)
                .map(authData -> {
                    String stateJwt = oauthService.buildStateJwt(authData, 600); // 10 min TTL
                    
                    return ResponseEntity.status(HttpStatus.FOUND)
                            .location(URI.create(authData.authorizeUrl()))
                            .header("Set-Cookie", "of_oauth_" + authData.state() + "=" + stateJwt)
                            .build();
                });
    }
    
    // Handle OAuth callback
    @GetMapping("/oauth/callback")
    public Mono<ResponseEntity<Void>> callback(
            @RequestParam String code,
            @RequestParam String state,
            ServerHttpRequest request) {
        
        return oauthService.handleCallback(code, state, request)
                .map(result -> ResponseEntity.status(HttpStatus.FOUND)
                        .location(URI.create(result.redirectTarget()))
                        .build());
    }
}
```