<!-- source-hash: a91c08bb2b49a3caaaaf10bbe224c733 -->
A security decorator for WebSocket services that automatically closes authenticated WebSocket sessions when JWT tokens expire, preventing unauthorized access after token expiration.

## Key Components

- **WebSocketServiceSecurityDecorator** - Main decorator class implementing `WebSocketService`
- **handleRequest()** - Intercepts WebSocket connections and applies security logic for secured endpoints
- **scheduleSessionRemoveJob()** - Creates a scheduled task to close sessions when JWT expires
- **processSessionClosedEvent()** - Handles cleanup when sessions are manually closed
- **isSecuredEndpoint()** - Determines if a WebSocket path requires JWT authentication
- **CLOCK_SKEW_SECONDS** - 60-second tolerance for JWT expiration timing

## Usage Example

```java
@Configuration
public class WebSocketConfig {

    @Bean
    public WebSocketServiceSecurityDecorator webSocketSecurity(
            WebSocketService defaultService,
            RequestJwt–°laimsReader jwtReader) {
        return new WebSocketServiceSecurityDecorator(defaultService, jwtReader);
    }

    @Bean
    public RouterFunction<ServerResponse> webSocketRoutes(
            WebSocketServiceSecurityDecorator securityService) {
        return RouterFunctions.route()
            .GET("/api/tools/ws/**", securityService::handleRequest)
            .build();
    }
}
```

The decorator wraps the default WebSocket service, automatically scheduling session termination based on JWT expiration time plus a 60-second clock skew tolerance. It only applies security logic to predefined secured endpoints, allowing unsecured WebSocket connections to pass through unchanged.