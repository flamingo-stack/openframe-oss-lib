<!-- source-hash: 5f24f1bef300427aa85a4abe4e9c03b1 -->
This Spring Security configuration class establishes security policies for the OpenFrame Gateway API, implementing JWT-based authentication with role-based access control (RBAC) for ADMIN and AGENT users.

## Key Components

- **ReactiveJwtAuthenticationConverter** - Converts JWT tokens into Spring Security authorities, extracting both roles and scopes
- **SecurityWebFilterChain** - Main security filter chain defining route-based authorization rules
- **AddAuthorizationHeaderFilter** - Custom filter for adding authorization headers before authentication
- **PasswordEncoder** - BCrypt password encoder bean for secure password hashing

## Usage Example

```java
@RestController
@RequestMapping("/api/admin")
public class AdminController {
    
    // This endpoint requires ROLE_ADMIN due to API_PREFIX pattern matching
    @GetMapping("/users")
    public Flux<User> getAllUsers() {
        return userService.findAll();
    }
}

@RestController  
@RequestMapping("/tools/agent")
public class AgentToolsController {
    
    // This endpoint requires ROLE_AGENT due to TOOLS_PREFIX + "/agent/**" pattern
    @PostMapping("/scan")
    public Mono<ScanResult> performScan(@RequestBody ScanRequest request) {
        return scanService.execute(request);
    }
}
```

The configuration supports multi-issuer JWT authentication through `ReactiveAuthenticationManagerResolver`, allowing different identity providers to authenticate users. Public endpoints like agent registration and metrics collection are permitted without authentication, while administrative and agent-specific routes enforce appropriate role requirements.