<!-- source-hash: ebcff04caa561e342e1d5b43b2dafd4a -->
Service class that manages agent registration secrets with encrypted storage, automatic rotation, and lifecycle management for secure agent authentication.

## Key Components

- **getActiveSecret()** - Retrieves the currently active registration secret, decrypting it for use
- **getAllSecrets()** - Returns all registration secrets in the system with their metadata
- **generateNewSecret()** - Creates a new registration secret, automatically deactivating the previous one
- **deactivateExisting()** - Private method that deactivates the current active secret during rotation

## Dependencies

- **AgentRegistrationSecretRepository** - Database operations for secret persistence
- **EncryptionService** - Handles encryption/decryption of secret keys at rest
- **AgentRegistrationSecretGenerator** - Generates cryptographically secure secret keys

## Usage Example

```java
@RestController
@RequiredArgsConstructor
public class AgentController {
    
    private final AgentRegistrationSecretService secretService;
    
    @GetMapping("/agent/registration-key")
    public AgentRegistrationSecretResponse getCurrentSecret() {
        return secretService.getActiveSecret();
    }
    
    @PostMapping("/admin/rotate-secret")
    public AgentRegistrationSecretResponse rotateSecret() {
        return secretService.generateNewSecret();
    }
    
    @GetMapping("/admin/secrets")
    public List<AgentRegistrationSecretResponse> listAllSecrets() {
        return secretService.getAllSecrets();
    }
}
```

The service ensures only one secret is active at a time and maintains an audit trail of all generated secrets. Secrets are encrypted in the database and only decrypted when needed for agent registration or administrative purposes.