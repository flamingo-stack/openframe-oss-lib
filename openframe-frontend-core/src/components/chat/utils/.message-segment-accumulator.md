<!-- source-hash: cff141bf1c94cc3e98e3c44f584a3383 -->
Manages accumulation and state tracking of message segments during real-time streaming or historical message processing in chat applications.

## Key Components

**MessageSegmentAccumulator Class:**
- `appendText()` - Accumulates text content, merging with existing text segments
- `addToolExecution()` - Manages tool execution states (EXECUTING_TOOL â†’ EXECUTED_TOOL transitions)
- `addApprovalRequest()` - Creates approval request segments for user confirmation
- `processApprovalResult()` - Handles approval responses and updates segment status
- `initializeWithState()` - Restores accumulator from saved state for session continuity
- `getState()` / `reset()` - State management for serialization and cleanup

**Helper Functions:**
- `createMessageSegmentAccumulator()` - Factory function for creating accumulator instances

## Usage Example

```typescript
import { MessageSegmentAccumulator, AccumulatorCallbacks } from './message-segment-accumulator'

// Create accumulator with approval callbacks
const callbacks: AccumulatorCallbacks = {
  onApprove: async (requestId) => console.log(`Approved: ${requestId}`),
  onReject: async (requestId) => console.log(`Rejected: ${requestId}`)
}

const accumulator = new MessageSegmentAccumulator(callbacks)

// Accumulate streaming text
accumulator.appendText('Hello ')
accumulator.appendText('world!') // Merges into single text segment

// Add tool execution
accumulator.addToolExecution({
  type: 'tool_execution',
  data: {
    type: 'EXECUTING_TOOL',
    integratedToolType: 'filesystem',
    toolFunction: 'readFile',
    parameters: { path: '/home/user/file.txt' }
  }
})

// Process approval request
accumulator.addApprovalRequest('req-123', 'rm -rf temp/', 'Delete temp files', 'SYSTEM')

// Get final segments
const segments = accumulator.getSegments()
```